<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>لوحة التحكم</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(to bottom right, #f9fdfd, #e6faff, #f0fcfb);
      -webkit-font-smoothing: antialiased;
      font-family: 'Cairo', sans-serif;
    }

    header {
      background: linear-gradient(90deg, #168dfa, #5DAAB7);
      animation: fadeDown 0.6s ease;
    }

    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .device { width: 100%; max-width: 420px; min-height: 844px; margin: 20px auto; }
    .progress-track { background: rgba(255,255,255,0.3); height: 10px; border-radius: 999px; overflow: hidden; }
    .progress-bar { height: 10px; border-radius: 999px; width: 0%; transition: width 0.6s cubic-bezier(0.65, 0, 0.35, 1); }

    .card-shadow {
      box-shadow: 0 6px 15px rgba(0,0,0,0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card-shadow:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }

    .fade-in { animation: fadeInUp 0.4s ease; }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .popup-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.4); display: none;
      align-items: center; justify-content: center; z-index: 100;
      backdrop-filter: blur(4px);
    }
    .popup-box {
      background: white; padding: 20px; border-radius: 16px;
      max-width: 300px; width: 85%; text-align: center;
      transform: scale(0.7); opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      border: 2px solid rgba(0,161,255,0.1);
    }
    .popup-box.show { transform: scale(1); opacity: 1; }

    #motivate { animation: pulse 2s ease-in-out infinite alternate; }
    @keyframes pulse {
      from { transform: scale(1); opacity: 1; }
      to { transform: scale(1.02); opacity: 0.95; }
    }

    nav a:hover svg {
      transform: scale(1.1);
      transition: transform 0.3s ease;
    }

    .nav-item.active { color: #168dfa; }
  </style>
</head>
<body class="p-4">
  <div class="device fade-in">
    <div class="w-full mx-auto bg-white rounded-2xl overflow-hidden">

      <header class="p-4 text-white shadow-md rounded-b-2xl">
        <div class="flex items-center justify-between">
          <div class="text-right">
            <div class="text-lg font-semibold">أهلاً بك</div>
            <span id="adhdResult" class="text-xs opacity-90"></span>
          </div>
        </div>
      </header>

      <main class="p-4 space-y-4">
        <h2 class="text-right font-bold text-lg text-gray-700">التقدم اليومي</h2>

        <div class="grid grid-cols-2 gap-3">
          <div class="rounded-xl p-4 card-shadow bg-gradient-to-br from-[#10b981] to-[#a7f3d0]">
            <div class="text-white">
              <div id="tasksPercent" class="text-lg font-semibold">0%</div>
              <div class="text-sm opacity-80">المهام اليومية</div>
            </div>
            <div class="mt-2 progress-track">
              <div id="tasksBar" class="progress-bar bg-white"></div>
            </div>
          </div>
          <div class="rounded-xl p-4 card-shadow bg-gradient-to-br from-[#8b5cf6] to-[#c4b5fd]">
             <div class="text-white">
              <div id="challengesPercent" class="text-lg font-semibold">0%</div>
              <div class="text-sm opacity-80">القرارات</div>
            </div>
            <div class="mt-2 progress-track">
              <div id="challengesBar" class="progress-bar bg-white"></div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <button onclick="window.location.href='schedule.html'" class="w-full rounded-xl p-4 h-16 bg-[#168dfa] text-white card-shadow transition transform active:scale-95">اضبط جدولك</button>
          <button id="motivate" class="w-full rounded-xl p-4 h-16 bg-gradient-to-r from-[#168dfa] to-[#5DAAB7] text-white card-shadow transition transform active:scale-95">حفزني</button>
        </div>

        <div class="rounded-2xl p-4 bg-white card-shadow">
          <div class="flex items-center justify-between mb-2">
            <div class="text-lg font-bold text-gray-800">جدول اليوم</div>
            <a href="schedule.html" class="text-gray-400 transition transform active:scale-90 hover:text-[#168dfa]">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m3 4h-14a2 2 0 00-2 2v8a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2z"/>
              </svg>
            </a>
          </div>
          <div id="schedulePreview" class="space-y-2 text-sm text-gray-500">
            <p>تحميل المهام...</p>
          </div>
        </div>

        <div onclick="window.location.href='decis1.html'" class="rounded-xl p-4 bg-gradient-to-r from-[#168dfa] to-[#5DAAB7] text-white flex items-center justify-between card-shadow transition transform hover:scale-105 active:scale-100 cursor-pointer">
          <div class="text-right">
            <div class="font-bold">اتخذ قرار!</div>
            <div class="text-sm opacity-90">متردد في قرار؟ دعنا نساعدك</div>
          </div>
          <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="white"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 9l4-4 4 4M8 15l4 4 4-4"/></svg>
          </div>
        </div>

      </main>
        <nav class="sticky bottom-4 mx-4 bg-white/80 backdrop-blur-sm border border-gray-200 shadow-lg rounded-xl z-50">
          <div class="flex justify-around py-2">
            <a href="home.html" class="flex flex-col items-center text-[#168dfa]">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 9.75L12 4l9 5.75V20a2 2 0 01-2 2H5a2 2 0 01-2-2V9.75z" />
              </svg>
              <span class="text-xs font-semibold">الرئيسية</span>
            </a>
            <a href="decis1.html" class="flex flex-col items-center text-gray-600 hover:text-[#168dfa]">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l4-4 4 4m-8 6l4 4 4-4" />
              </svg>
              <span class="text-xs">اتخذ قرار</span>
            </a>
            <a href="pomodoro.html" class="flex flex-col items-center text-gray-600 hover:text-[#168dfa]">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-xs">بومودورو</span>
            </a>
            <a href="schedule.html" class="flex flex-col items-center text-gray-600 hover:text-[#168dfa]">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M4 11h16M4 19h16M5 7h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V9a2 2 0 012-2z" />
              </svg>
              <span class="text-xs">الجدول</span>
            </a>
            <a href="results.html" class="flex flex-col items-center text-gray-600 hover:text-[#168dfa]">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-xs">النتيجة</span>
            </a>
          </div>
        </nav>
    </div>
  </div>

  <div id="popup" class="popup-overlay">
    <div class="popup-box">
      <p id="quoteText" class="mb-4 text-gray-700"></p>
      <button onclick="closePopup()" class="px-4 py-2 bg-[#168dfa] text-white rounded-lg hover:bg-[#5DAAB7] transition">إغلاق</button>
    </div>
  </div>

  <script>
    const quotes = [
      "خذ الأمور خطوة بخطوة، ليس عليك إنجاز كل شيء دفعة واحدة.",
      "التنظيم يساعدك على السيطرة، ولو بخطوات صغيرة.",
      "الراحة جزء من الإنتاجية، لا تنس أن تعطي نفسك وقتًا.",
      "أنت قادر على الإنجاز، فقط قسم المهام واجعلها أبسط."
    ];

    const popup = document.getElementById("popup");
    const quoteText = document.getElementById("quoteText");

    document.getElementById("motivate").addEventListener("click", ()=>{
      const q = quotes[Math.floor(Math.random()*quotes.length)];
      quoteText.textContent = q;
      popup.style.display = "flex";
      setTimeout(()=> document.querySelector(".popup-box").classList.add("show"), 50);
    });

    function closePopup(){
      document.querySelector(".popup-box").classList.remove("show");
      setTimeout(()=> popup.style.display="none", 300);
    }
    popup.addEventListener('click', (e) => {
        if(e.target === popup) {
            closePopup();
        }
    });

    // Function to render schedule preview
    function renderSchedulePreview() {
      const LS_KEY = "dailySchedule_v2";
      const today = new Date().toISOString().slice(0,10);
      const preview = document.getElementById("schedulePreview");
      const percentEl = document.getElementById("tasksPercent");
      const barEl = document.getElementById("tasksBar");

      const raw = localStorage.getItem(LS_KEY);
      if(!raw){ 
          preview.innerHTML = "<p class='text-center p-4'>لا توجد مهام حتى الآن</p>"; 
          percentEl.textContent="0%"; 
          barEl.style.width = "0%";
          return; 
      }

      const parsed = JSON.parse(raw);
      if(parsed.date !== today || !parsed.items || parsed.items.length===0){
        preview.innerHTML = "<p class='text-center p-4'>لا توجد مهام حتى الآن</p>"; 
        percentEl.textContent="0%"; 
        barEl.style.width = "0%";
        return;
      }

      const tasks = parsed.items.sort((a,b)=>a.time.localeCompare(b.time)).slice(0,3);
      preview.innerHTML = tasks.map(it=>`
        <div class='flex items-center justify-between p-3 rounded-xl ${it.done ? 'bg-green-50' : 'bg-gray-50'}'>
          <div class='text-right'>
            <div class='font-semibold text-md text-gray-800 ${it.done ? 'line-through' : ''}'>${it.title}</div>
            <div class='text-sm text-gray-500'>${it.time}</div>
          </div>
          <div class='w-5 h-5 rounded-full ${it.done ? 'bg-green-400' : 'border-2 border-gray-300'} flex items-center justify-center text-white'>
            ${it.done ? '✓' : ''}
          </div>
        </div>`).join("");

      const total = parsed.items.length;
      const done = parsed.items.filter(it=>it.done).length;
      const percent = total ? Math.round((done/total)*100) : 0;

      percentEl.textContent = percent + "%";
      barEl.style.width = percent + "%";
    }

    // Function to render challenges progress
    function renderChallengesProgress() {
      const maxChallenges = 5; // Let's set a goal of 5 decisions per week
      const taken = parseInt(localStorage.getItem("takenCount")||"0");
      let percent = Math.min(100, Math.round((taken / maxChallenges) * 100));

      document.getElementById("challengesPercent").textContent = percent + "%";
      document.getElementById("challengesBar").style.width = percent + "%";
    }
    
    // Function to show ADHD result
    function showADHDResult() {
        const whoResult = localStorage.getItem("whoResult");
        const resultEl = document.getElementById("adhdResult");
        if (whoResult) {
            resultEl.textContent = "نتيجة اختبار ADHD: " + whoResult;
        } else {
            resultEl.textContent = "لم تقم باختبار ADHD بعد.";
        }
    }

    // Initial render on page load
    document.addEventListener('DOMContentLoaded', () => {
        renderSchedulePreview();
        renderChallengesProgress();
        showADHDResult();
    });

    // Re-render when returning to the page (e.g., from another tab)
    window.addEventListener('focus', () => {
        renderSchedulePreview();
        renderChallengesProgress();
    });

  </script>
</body>
</html>
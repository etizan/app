<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ø¯Ø±Ø¨ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(to bottom right, #f9fdfd, #e6faff, #f0fcfb);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 0.6s ease;
      margin: 0;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    header {
      background: #f8fffe;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      padding: 10px 14px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 16px auto 12px;
      width: 100%;
      max-width: 420px;
    }

    .container {
      width: 100%;
      max-width: 420px;
      padding: 16px;
    }

    .neo-circle {
      background: #e6f9f7;
      border-radius: 9999px;
      box-shadow:
        inset 6px 6px 12px rgba(0,0,0,0.05),
        inset -6px -6px 12px rgba(255,255,255,0.8),
        0 0 18px rgba(22,141,250,0.06);
      transition: transform 0.18s ease;
      position: relative;
    }
    .neo-circle.active {
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 18px rgba(22,141,250,0.06); }
      50% { transform: scale(1.03); box-shadow: 0 0 26px rgba(22,141,250,0.12); }
      100% { transform: scale(1); box-shadow: 0 0 18px rgba(22,141,250,0.06); }
    }

    .ring-wrap { position: absolute; inset: -10px; display:flex; align-items:center; justify-content:center; pointer-events:none; }
    svg.progress-ring { transform: rotate(-90deg); width: 100%; height: 100%; }
    .progress-bg { stroke: rgba(93,170,183,0.15); stroke-width:8; fill:none; }
    .progress-fg { stroke: url(#grad); stroke-width:8; fill:none; stroke-linecap:round; filter: drop-shadow(0 2px 6px rgba(93,170,183,0.25)); transition: stroke-dashoffset 0.4s linear; }

    .decision-card {
      background: #f8fffe;
      border-radius: 14px;
      padding: 14px;
      text-align: center;
      box-shadow: 0 6px 15px rgba(0,0,0,0.05);
    }

    .btn-primary {
      flex: 1;
      background: linear-gradient(90deg, #168dfa, #5DAAB7);
      color: white;
      font-weight: 600;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(22,141,250,0.2);
      transition: all 0.18s ease;
      padding: 12px 0;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(22,141,250,0.25);
    }
    .btn-secondary {
       flex: 1;
       background: #f1f5f9;
       color: #475569;
       font-weight: 600;
       border-radius: 12px;
       box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       transition: all 0.18s ease;
       padding: 12px 0;
    }
    .btn-secondary:hover{
       transform: translateY(-2px);
       background: #e2e8f0;
    }


    .text-main { color: #168dfa; }
    .text-accent { color: #5DAAB7; }
    .time-large { font-size: 2.5rem; font-weight: 700; }
  </style>
</head>

<body>
  <header>
    <button onclick="window.location.href='decis1.html'" style="background:none;border:none;color:#168dfa;font-weight:600;">â† Ø±Ø¬ÙˆØ¹</button>
    <div style="font-weight:700;color:#334155">Ù…Ø¯Ø±Ø¨ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±</div>
    <div style="width:40px"></div>
  </header>

  <main class="container text-center">
    <div class="decision-card mb-5">
      <p class="font-semibold text-lg text-accent" id="adviceText">ğŸš€ Ø«Ù‚ Ø¨Ø­Ø¯Ø³Ùƒ!</p>
      <p class="text-sm text-gray-500">Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙˆØ§Ù„Ù…Ø¯Ø±ÙˆØ³Ø© ØªØ¨Ù†ÙŠ Ø§Ù„Ø«Ù‚Ø©.</p>
    </div>

    <div style="position:relative; margin:28px 0; height:250px;" class="flex justify-center items-center">
      <div id="circle" class="neo-circle w-56 h-56 flex justify-center items-center" style="width:220px;height:220px;">
        <div style="text-align:center;">
          <div id="timerNumber" class="text-main time-large">15</div>
          <div style="color:#6b7280;margin-top:6px">Ø«Ø§Ù†ÙŠØ©</div>
        </div>
        <div class="ring-wrap" aria-hidden="true">
          <svg class="progress-ring" viewBox="0 0 120 120" preserveAspectRatio="xMidYMid meet">
            <defs>
              <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#168dfa"/>
                <stop offset="100%" stop-color="#5DAAB7"/>
              </linearGradient>
            </defs>
            <circle class="progress-bg" cx="60" cy="60" r="50"></circle>
            <circle id="progressCircle" class="progress-fg" cx="60" cy="60" r="50"></circle>
          </svg>
        </div>
      </div>
    </div>

    <div id="decisionCard" class="decision-card mb-6"></div>

    <div class="flex gap-4 mt-4">
      <button id="noBtn" class="btn-secondary">Ù„Ø§</button>
      <button id="yesBtn" class="btn-primary">Ù†Ø¹Ù…</button>
    </div>

    <div class="mt-6 text-center">
      <button id="backBtn" class="text-accent font-semibold hover:underline">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>
  </main>

  <div id="celebrationModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 w-96 text-center relative overflow-hidden shadow-xl">
      <div class="absolute left-4 bottom-4 text-4xl">ğŸ‰</div>
      <div class="absolute right-4 top-4 text-4xl">âœ¨</div>
      <h2 id="celebrationTitle" class="text-3xl font-extrabold mb-3 text-main"></h2>
      <p id="celebrationResult" class="text-lg text-gray-700 mb-3"></p>
      <p id="celebrationQuote" class="text-sm text-gray-500 italic"></p>
      <canvas id="confettiCanvas" class="absolute inset-0 pointer-events-none"></canvas>
    </div>
  </div>

  <audio id="celebrationSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_8b0e52f5d7.mp3?filename=short-success-sound-glockenspiel-treasure-video-game-6346.mp3"></audio>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const CIRC = 2 * Math.PI * 50;
    const progressCircle = document.getElementById('progressCircle');
    progressCircle.style.strokeDasharray = CIRC;
    progressCircle.style.strokeDashoffset = CIRC;

    function setProgress(ratio){
      const offset = CIRC * (1 - ratio);
      progressCircle.style.strokeDashoffset = offset;
    }

    // LocalStorage utils
    function setItemWithExpiry(key, value) {
      const now = new Date();
      const expiry = now.getTime() + 7*24*60*60*1000;
      const item = { value, expiry };
      localStorage.setItem(key, JSON.stringify(item));
    }
    function getItemWithExpiry(key) {
      const itemStr = localStorage.getItem(key);
      if (!itemStr) return null;
      const item = JSON.parse(itemStr);
      const now = new Date();
      if (now.getTime() > item.expiry) {
        localStorage.removeItem(key);
        return null;
      }
      return item.value;
    }
    function getDecisions(){ return getItemWithExpiry("decisions") || []; }
    function setDecisions(list){ setItemWithExpiry("decisions", list); }

    const card=document.getElementById("decisionCard");
    const idx=parseInt(localStorage.getItem("currentDecision")||"-1");
    const data=getDecisions();
    if(idx>=0 && idx<data.length){
      const d=data[idx];
      card.innerHTML=`<h2 class="text-lg font-semibold mb-2 text-main">${d.title}</h2><p class="text-gray-500">${d.type}</p>`;
    }else{
      card.innerHTML=`<p class='text-gray-500'>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø±. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¹ÙˆØ¯Ø© ÙˆØ¥Ø¶Ø§ÙØ© ÙˆØ§Ø­Ø¯.</p>`;
    }

    // Timer
    let duration=15;
    let timerId = null;
    const timerNumber=document.getElementById("timerNumber");
    const circle=document.getElementById("circle");
    function startTimer(){
      let start=null;
      function animate(ts){
        if(!start) start=ts;
        const elapsed=(ts-start)/1000;
        const remaining=Math.max(0,duration-elapsed);
        timerNumber.textContent=Math.ceil(remaining);
        const progress=Math.min(1,elapsed/duration);
        setProgress(progress);
        if(remaining>0){ timerId = requestAnimationFrame(animate); }
        else{ timeOut(); }
      }
      circle.classList.add('active');
      timerId = requestAnimationFrame(animate);
    }
    startTimer();

    const quotes=[
      "Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„ØªØ±Ø¯Ø¯ Ø§Ù„Ø·ÙˆÙŠÙ„.",
      "Ø§Ù„ØªØ´ØªØª Ø·Ø¨ÙŠØ¹ÙŠ.. Ù„ÙƒÙ† Ø§Ù„Ù‚Ø±Ø§Ø± Ù‡Ùˆ Ù‚ÙˆØªÙƒ.",
      "ÙƒÙ„ Ù‚Ø±Ø§Ø± Ù‡Ùˆ ØªØ¯Ø±ÙŠØ¨ Ù„Ø¹Ù‚Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².",
      "Ø§Ù„ØªØ±ÙƒÙŠØ² ÙŠØ¨Ø¯Ø£ Ø¨Ø®Ø·ÙˆØ©ØŒ ÙˆØ§Ù„Ø®Ø·ÙˆØ© ØªØ¨Ø¯Ø£ Ø¨Ù‚Ø±Ø§Ø±.",
      "Ù„Ø§ ØªÙ†ØªØ¸Ø± Ø§Ù„ÙƒÙ…Ø§Ù„.. ØªØ­Ø±Ùƒ Ø§Ù„Ø¢Ù†.",
    ];

    function stopTimer() {
        if(timerId) {
            cancelAnimationFrame(timerId);
            timerId = null;
        }
    }

    function showCelebration(decisionTitle, resultText){
      stopTimer();
      const modal=document.getElementById("celebrationModal");
      document.getElementById("celebrationTitle").textContent=decisionTitle;
      document.getElementById("celebrationResult").textContent="Ù‚Ø±Ø§Ø±Ùƒ: "+resultText;
      document.getElementById("celebrationQuote").textContent=quotes[Math.floor(Math.random()*quotes.length)];
      modal.classList.remove("hidden");
      modal.style.display = 'flex';
      document.getElementById("celebrationSound").play().catch(e => console.log("Audio play failed"));

      const confettiDuration = 2*1000;
      const end = Date.now() + confettiDuration;
      (function frame(){
        confetti({ particleCount: 8, angle: 60, spread: 55, origin: { x: 0, y: 1 } });
        confetti({ particleCount: 8, angle: 120, spread: 55, origin: { x: 1, y: 1 } });
        if(Date.now() < end) requestAnimationFrame(frame);
      })();
      setTimeout(()=>window.location.href="decis1.html",2500);
    }

    function timeOut(){
      stopTimer();
      if(idx>=0 && data[idx]){
        data[idx].status="expired";
        setDecisions(data);
      }
      alert("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ù„Ù… ÙŠØªÙ… Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±.");
      window.location.href="decis1.html";
    }

    document.getElementById("yesBtn").onclick=()=>{ 
      if(idx>=0 && data[idx]){ 
        const title=data[idx].title; 
        data.splice(idx,1); 
        setDecisions(data); 
        showCelebration(title,"Ù†Ø¹Ù…"); 
      } 
    };
    document.getElementById("noBtn").onclick=()=>{ 
      if(idx>=0 && data[idx]){ 
        const title=data[idx].title; 
        data.splice(idx,1); 
        setDecisions(data); 
        showCelebration(title,"Ù„Ø§"); 
      } 
    };
    document.getElementById("backBtn").onclick=()=>window.location.href="decis1.html";
  </script>
</body>
</html>
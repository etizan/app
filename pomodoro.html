<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>وضع التركيز (بومودورو)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(to bottom right, #f9fdfd, #e6faff, #f0fcfb);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pageFade 0.6s ease;
      margin:0;
      padding: 1rem;
    }
    @keyframes pageFade {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .container { width:100%; max-width:420px; padding:16px; }

    header {
      background: #f8fffe;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      padding:10px 12px;
      border-radius:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    .fade { opacity: 0; transition: opacity 0.45s ease; }
    .fade.show { opacity: 1; }

    .neo-circle {
      background: #e6f9f7;
      border-radius: 9999px;
      box-shadow:
        inset 6px 6px 12px rgba(0,0,0,0.05),
        inset -6px -6px 12px rgba(255,255,255,0.8),
        0 0 18px rgba(22,141,250,0.06);
      transition: transform 0.18s ease;
      position: relative;
    }
    .neo-circle.active {
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); box-shadow: 0 0 26px rgba(22,141,250,0.12); }
      100% { transform: scale(1); }
    }

    .soft-dot {
      background: #dff7f5;
      border-radius: 9999px;
      box-shadow:
        6px 6px 12px rgba(0,0,0,0.06),
        -6px -6px 12px rgba(255,255,255,0.7);
      width:56px; height:56px;
    }

    .control-btn {
      width: 56px; height: 56px; border-radius: 9999px;
      display: flex; align-items: center; justify-content: center;
      background: white;
      color: #168dfa;
      box-shadow: 6px 6px 12px rgba(0,0,0,0.06),
                  -6px -6px 12px rgba(255,255,255,0.7);
      transition: transform 0.18s ease, box-shadow 0.22s ease;
      border: none;
      cursor: pointer;
    }
    .control-btn:hover { transform: scale(1.08); box-shadow:0 8px 20px rgba(22,141,250,0.12); }

    svg.icon { width:22px; height:22px; fill:#168dfa; }

    .text-main { color: #168dfa; }
    .text-emerald { color: #0f8073; font-weight:600; }
    .text-turquoise { color: #168dfa; letter-spacing:1px; }

    @keyframes shake {
      0%,100% { transform: translate(0,0); }
      20%,60% { transform: translate(-5px,0); }
      40%,80% { transform: translate(5px,0); }
    }
    .shake { animation: shake 0.6s ease; }

    .center { display:flex; align-items:center; justify-content:center; }

    .ring-wrap { position: absolute; inset: -10px; display:flex; align-items:center; justify-content:center; pointer-events:none; }
    svg.progress-ring { transform: rotate(-90deg); width: 100%; height: 100%; }
    .progress-bg { stroke: rgba(8,117,124,0.08); stroke-width:8; fill:none; }
    .progress-fg { stroke: url(#grad); stroke-width:8; fill:none; stroke-linecap:round; filter: drop-shadow(0 2px 6px rgba(43,179,155,0.18)); transition: stroke-dashoffset 0.6s linear; }

    .time-large { font-size:2.25rem; font-weight:700; }
    .hidden { display: none; }

    @media (max-width:420px){
      .neo-circle.w-56 { width:200px; height:200px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="focusScreen" class="fade show">
      <header>
        <button onclick="window.location.href='home.html'" style="background:none;border:none;color:#0f8073;font-weight:600;cursor:pointer">← رجوع</button>
        <div style="font-weight:700;color:#334155">وضع التركيز</div>
        <div style="width:40px"></div>
      </header>

      <div style="position:relative; margin:28px 0; height:250px;" class="center">
        <div id="circle" class="neo-circle w-56 h-56 center" style="width:220px;height:220px;">
          <div style="text-align:center;">
            <div id="timeDisplay" class="text-main time-large">٢٥:٠٠</div>
            <div style="color:#6b7280;margin-top:6px">دقائق</div>
          </div>
          <div class="ring-wrap" aria-hidden="true">
            <svg class="progress-ring" viewBox="0 0 120 120" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="grad" x1="0%" x2="100%">
                  <stop offset="0%" stop-color="#168dfa"/>
                  <stop offset="60%" stop-color="#40E0D0"/>
                  <stop offset="100%" stop-color="#065e63"/>
                </linearGradient>
              </defs>
              <circle class="progress-bg" cx="60" cy="60" r="50"></circle>
              <circle id="progressCircle" class="progress-fg" cx="60" cy="60" r="50" stroke-dasharray="314.159" stroke-dashoffset="0"></circle>
            </svg>
          </div>
        </div>
      </div>

      <div class="center" style="flex-direction:column; gap:6px;">
        <div class="text-emerald">انت بتعمل انجاز كبير !</div>
        <div style="color:#6b7280;font-size:0.9rem">خليك مركز، انت قدها</div>
      </div>

      <div style="text-align:center;margin-top:12px;font-weight:700;color:#168dfa;font-size:1.05rem">تركيز</div>

      <div style="display:flex;justify-content:center;gap:18px;margin-top:18px;">
        <button id="stopBtn" class="control-btn" title="إيقاف">
          <svg class="icon" viewBox="0 0 24 24"><rect x="5" y="5" width="14" height="14" rx="2"/></svg>
        </button>
        <button id="playPauseBtn" class="control-btn" title="تشغيل/إيقاف">
          <svg id="playIcon" class="icon" viewBox="0 0 24 24"><path d="M6 4L20 12L6 20V4Z"/></svg>
          <svg id="pauseIcon" class="icon hidden" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/></svg>
        </button>
      </div>

      <div style="display:flex;justify-content:flex-end;margin-top:20px">
        <div class="soft-dot"></div>
      </div>
    </div>

    <div id="breakScreen" class="fade hidden">
      <header>
        <button id="backBtn" style="background:none;border:none;color:#0f8073;font-weight:600;cursor:pointer">← رجوع</button>
        <div style="font-weight:700;color:#334155">استراحة قصيرة</div>
        <div style="width:40px"></div>
      </header>

      <div style="position:relative; margin:28px 0; height:250px;" class="center">
        <div id="breakCircle" class="neo-circle w-56 h-56 center" style="width:220px;height:220px;">
          <div style="text-align:center;">
            <div id="breakDisplay" class="text-main time-large">٠٥:٠٠</div>
            <div style="color:#6b7280;margin-top:6px">دقائق</div>
          </div>
          <div class="ring-wrap" aria-hidden="true">
            <svg class="progress-ring" viewBox="0 0 120 120" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="gradBreak" x1="0%" x2="100%">
                  <stop offset="0%" stop-color="#168dfa"/>
                  <stop offset="60%" stop-color="#40E0D0"/>
                  <stop offset="100%" stop-color="#065e63"/>
                </linearGradient>
              </defs>
              <circle class="progress-bg" cx="60" cy="60" r="50"></circle>
              <circle id="progressCircleBreak" class="progress-fg" cx="60" cy="60" r="50" stroke-dasharray="314.159" stroke-dashoffset="0" stroke="url(#gradBreak)"></circle>
            </svg>
          </div>
        </div>
      </div>

      <div class="center" style="flex-direction:column; gap:6px;">
        <div class="text-emerald">برافو! وقت الاستراحة</div>
        <div style="color:#6b7280;font-size:0.9rem">خد نفس عميق وارتاح شوية</div>
      </div>

      <div style="text-align:center;margin-top:12px;font-weight:700;color:#168dfa;font-size:1.05rem">بريك</div>

      <div style="display:flex;justify-content:flex-end;margin-top:20px">
        <div class="soft-dot"></div>
      </div>
    </div>
  </div>

  <audio id="endSound" src="ding.mp3" preload="auto"></audio>

  <script>
    const focusSeconds = 25 * 60;
    const breakSeconds = 5 * 60;
    const CIRC = 2 * Math.PI * 50;

    const progressCircle = document.getElementById('progressCircle');
    const progressCircleBreak = document.getElementById('progressCircleBreak');
    progressCircle.style.strokeDasharray = CIRC.toString();
    progressCircleBreak.style.strokeDasharray = CIRC.toString();

    let onBreak = false, running = false, paused = false;
    let endTime = null, timer = null;
    let remaining = focusSeconds;
    
    const timeDisplay = document.getElementById('timeDisplay');
    const breakDisplay = document.getElementById('breakDisplay');
    const focusScreen = document.getElementById('focusScreen');
    const breakScreen = document.getElementById('breakScreen');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const backBtn = document.getElementById('backBtn');
    const endSound = document.getElementById('endSound');
    const circle = document.getElementById('circle');
    const breakCircle = document.getElementById('breakCircle');

    function toArabicIndic(numStr){
      const map = {0:'٠',1:'١',2:'٢',3:'٣',4:'٤',5:'٥',6:'٦',7:'٧',8:'٨',9:'٩'};
      return String(numStr).split('').map(ch=> map[ch] ?? ch).join('');
    }

    function formatSeconds(sec){
      const mins = Math.floor(sec/60);
      const s = String(sec%60).padStart(2,'0');
      return toArabicIndic(mins+":"+s);
    }

    function setProgressForRemaining(totalSeconds, remainingSeconds, isBreak){
      const ratio = Math.max(0, Math.min(1, remainingSeconds / totalSeconds));
      const offset = CIRC * (1 - ratio);
      if(isBreak){
        progressCircleBreak.style.strokeDashoffset = offset;
      } else {
        progressCircle.style.strokeDashoffset = offset;
      }
    }

    function showScreen(showEl, hideEl){
      hideEl.classList.remove('show');
      setTimeout(()=> {
        hideEl.classList.add('hidden');
        showEl.classList.remove('hidden');
        setTimeout(()=> showEl.classList.add('show'),50);
      },400);
    }

    function updateDisplays(rem, breaking){
      if(breaking){
        breakDisplay.textContent = formatSeconds(rem);
        setProgressForRemaining(breakSeconds, rem, true);
        showScreen(breakScreen, focusScreen);
        breakCircle.classList.add('active');
        circle.classList.remove('active');
      } else {
        timeDisplay.textContent = formatSeconds(rem);
        setProgressForRemaining(focusSeconds, rem, false);
        showScreen(focusScreen, breakScreen);
        circle.classList.add('active');
        breakCircle.classList.remove('active');
      }
    }

    function startTimer(seconds){
      endTime = Date.now() + seconds * 1000;
      running = true;
      paused = false;
      if(timer) clearInterval(timer);
      timer = setInterval(tick, 250);
    }

    function tick(){
      const remMs = endTime - Date.now();
      let rem = Math.ceil(remMs / 1000);
      remaining = rem;

      if(remMs > 0){ 
        const remSecFloat = Math.max(0, remMs / 1000);
        if(onBreak){
          breakDisplay.textContent = formatSeconds(rem);
          setProgressForRemaining(breakSeconds, remSecFloat, true);
        } else {
          timeDisplay.textContent = formatSeconds(rem);
          setProgressForRemaining(focusSeconds, remSecFloat, false);
        }
        return; 
      }

      clearInterval(timer); 
      timer = null; 
      running = false;
      circle.classList.remove('active');
      breakCircle.classList.remove('active');

      try { endSound.currentTime = 0; endSound.play(); } catch(e){}
      if(navigator.vibrate) navigator.vibrate([200, 100, 200]);

      if(!onBreak){
        onBreak = true;
        remaining = breakSeconds;
        startTimer(remaining);
        updateDisplays(remaining, true);
      } else {
        onBreak = false;
        remaining = focusSeconds;
        updateDisplays(remaining, false);
        playIcon.classList.remove('hidden'); 
        pauseIcon.classList.add('hidden');
      }
    }

    playPauseBtn.addEventListener('click', () => {
      if(!running && !paused){
        onBreak = false;
        remaining = focusSeconds;
        startTimer(remaining);
        playIcon.classList.add('hidden'); 
        pauseIcon.classList.remove('hidden');
      } 
      else if(running){
        clearInterval(timer);
        running = false;
        paused = true;
        circle.classList.remove('active');
        breakCircle.classList.remove('active');
        playIcon.classList.remove('hidden'); 
        pauseIcon.classList.add('hidden');
      } 
      else if(paused){
        startTimer(remaining);
        playIcon.classList.add('hidden'); 
        pauseIcon.classList.remove('hidden');
      }
    });

    stopBtn.addEventListener('click', () => { 
      clearInterval(timer); 
      running = false; 
      paused = false; 
      onBreak = false;
      remaining = focusSeconds;
      circle.classList.remove('active');
      breakCircle.classList.remove('active');
      updateDisplays(remaining, false);
      setProgressForRemaining(focusSeconds, focusSeconds, false);
      playIcon.classList.remove('hidden'); 
      pauseIcon.classList.add('hidden');
    });

    backBtn.addEventListener('click', () => { 
      clearInterval(timer); 
      running = false; 
      paused = false; 
      onBreak = false;
      remaining = focusSeconds;
      circle.classList.remove('active');
      breakCircle.classList.remove('active');
      updateDisplays(remaining, false);
      setProgressForRemaining(focusSeconds, focusSeconds, false);
      playIcon.classList.remove('hidden'); 
      pauseIcon.classList.add('hidden');
    });

    window.addEventListener('load', () => {
      updateDisplays(focusSeconds, false);
      setProgressForRemaining(focusSeconds, focusSeconds, false);
      setProgressForRemaining(breakSeconds, breakSeconds, true);
    });
  </script>
</body>
</html>